<!DOCTYPE html>
<html>
<head>
	<title>Edit settings</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script>
		//// ALL THE ANIMATED DIVS ////////////////////////////////////////////////////////////////

		function openNav() { //open the sidenav
			document.getElementById("sidepanel").style.width = "26%";
			document.getElementById("navicon").style.opacity = "0";
		}
		function closeNav() { //close the sidenav
			document.getElementById("sidepanel").style.width = "0%";
			document.getElementById("navicon").style.opacity = "1";
		}

		//// AUTHENTICATE /////////////////////////////////////////////////////////////////////////

		window.onLoad = check();

		function check() {
			if(document.cookie.toString().length == 0 || document.cookie.toString() == "null") {
				if(confirm("You aren't logged in, and you won't be able to access this page until you log in. Log in now?")) {
					window.location = "/login.html";
				}
				else {
					window.location = "/";
				}
			}
			else {
				var name = document.cookie.split(",")[0];
				var pass = document.cookie.split(",")[1];
				jQuery.post("/login", {username: name, pass: password}, function(result) {
					switch(result.split(",")[0]) {
						case "complete":
							password = result.split(",")[1];
							document.cookie = name + "," + password + "; path=/prefs.html";
							document.getElementById("warn").style.opacity = "0";
						break;
						case "password":
							if(confirm("Your password/username is incorrect, and you won't\n" +
								"be able to access this page until you log in\n. Log in now?")) {
								window.location = "/login.html";
							}
							else {
								window.location = "/";
							}
						break;
						case "username":
							if(confirm("Your username credentials doesn't exist, and you won't\n" +
								"be able to access this page until you log in\n. Log in now?")) {
								window.location = "/login.html";
							}
							else {
								window.location = "/";
							}
						break;

						default:
							alert("A server error occured. When you press \"OK\" the page will be refreshed." +
								"\nError: " + result);
							window.location.reload();
						break;
					}
				});
			}
		}

		//// SAVE DATA TO THE SERVER //////////////////////////////////////////////////////////////

		function post() {
			var name = document.cookie.split(",")[0];
			var pass = document.cookie.split(",")[1];
			var devLogs = document.getElementById("devLogs").value;
			var updateMails = document.getElementById("updateMails").value;

			jQuery.post("/save", {username: name, pass: password}, function(result) {
				switch(result) {
					case "complete":
						document.cookie = name + "," + password + "; path=/prefs.html";
						document.getElementById("warn").style.opacity = "0";
					break;
					case "password":
						if(confirm("Your password/username is incorrect, and you won't\n" +
							"be able to access this page until you log in\n. Log in now?")) {
							window.location = "/login.html";
						}
						else {
							window.location = "/";
						}
					break;
					case "username":
						if(confirm("Your username credentials doesn't exist, and you won't\n" +
							"be able to access this page until you log in\n. Log in now?")) {
							window.location = "/login.html";
						}
						else {
							window.location = "/";
						}
					break;

					default:
						alert("A server error occured. When you press \"OK\" the page will be refreshed." +
							"\nError: " + result);
						window.location.reload();
					break;
				}
			});
		}

		function logOut() {
			document.cookie = "; path=/prefs.html";
			window.location = "/login.html";
		}
	</script>
</head>
<body>
	<div class="topMenu"> <!--The top bar thing-->
		<img src="./images/navicon.png" id="navicon" onclick="openNav()""><!--The menu symbol-->
	</div>
	<a href="javascript:window.open('http://leppu.tumblr.com/');"><img id="tumblr" src="./images/tumblr.png"></a> <!--Leppu's Tumblr-->
	<a href="javascript:window.open('https://twitter.com/petra_nordlund');"><img id="twitter" src="./images/twitter.png"></a> <!--Leppu's Twitter-->
	<a href="javascript:window.open('http://www.praguerace.com/rss.php');"><img id="rss" src="./images/rss.png"></a> <!--Hiveworks's RSS--> <!--TBH I have no idea about how RSS works or how to use it-->
	<a href="javascript:window.open('https://www.patreon.com/praguerace');"><img id="patreon" src="./images/patreon.png"></a> <!--Leppu's Patreon--> <!--Please go donate!-->

	<div id="vertiBar"></div> <!--The side bar thing-->

	<img id="logo" src="./images/doofR.png"> <!--The werewolf face-->

	<div class="sidenav" id="sidepanel"> <!--The sidenav itself-->
		<br><br><br><br><br><br><br><br> <!--Highly sophisticated methods of spacing-->
		<h1><a href="javascript:void(0)" id="closebtn" onclick="closeNav()">&times;</a></h1>
		<h2><a href="/index.html">Back to the home page</a></h2>
		<br><br><br><br>
		<h2><a href="javascript:window.open('http://www.praguerace.com/');">Read the comic!</a></h2>
		<br><br><br><br>
		<h2><a href="/about">About this</a></h2>
	</div>

	<div class="notMenu">
		<input type="button" value="Log out" onclick="logOut()">
		<br><br>
		<input type="button" value="Change password" onclick="window.location = '/changePass.html'">
		<br><br>
		<form action="javascript:post()">
			<input type="checkbox" name="updates">Recieve emails when Prague Race updates
			<br><br>
			<input type="checkbox" name="devlogs">Send me developer updates from the website
			<br><br><br>
			<input type="submit" value="Submit">
		</form>
	</div>
</body>
</html>